# 程序化星球生成器 - 需求与功能说明书

## 1. 项目概述
**程序化星球生成器**是一个基于 Web 的交互式应用程序，能够实时渲染随机生成的 3D 星球。它利用程序化生成技术（噪声函数）和自定义 GLSL 着色器来模拟地形、气候、生物群落（Biomes）和海洋。用户可以实时调整各项参数，观察星球地质和生态系统的即时变化。

## 2. 核心功能

### 2.1. 程序化地形生成
- **基于噪声的拓扑结构：** 使用分形布朗运动 (FBM) 和 3D Simplex 噪声生成高度图。
- **可自定义参数：**
  - **种子 (Seed)：** 地形随机变化的随机种子。
  - **缩放 (Scale)：** 控制噪声特征的缩放比例（细节密度）。
  - **倍频 (Octaves)：** 决定地形的细节层次（分形复杂度）。
  - **持续性 (Persistence)：** 影响地形的粗糙程度。
  - **空隙度 (Lacunarity)：** 控制倍频之间的频率间隙。

### 2.2. 气候与生物群落系统
- **Whittaker 生物群落分类：** 根据**温度**和**湿度**的组合确定生物群落。
- **温度模拟：**
  - **纬度梯度：** 温度从赤道向两极自然递减。
  - **海拔降温：** 高海拔地区由于气温直减率导致温度降低。
  - **噪声干扰：** 为温度带增加自然的随机波动。
- **湿度模拟：** 使用独立的噪声层模拟多雨和干旱地区。
- **支持的生物群落：**
  - **热带：** 热带雨林、季节性森林。
  - **温带：** 温带雨林、落叶林、草地、灌木丛。
  - **干旱/炎热：** 亚热带沙漠、温带沙漠。
  - **寒带/极地：** 针叶林（Taiga）、苔原（Tundra）、焦土、冰雪。

### 2.3. 动态水域与冰盖
- **可调海平面：** 用户可以升高或降低海洋平面，动态淹没低地。
- **海洋深度渐变：** 视觉上区分浅海（近岸）和深海区域。
- **极地冰盖：**
  - **纬度与海拔结合：** 冰雪在两极和高山顶峰形成。
  - **可控范围：** “冰盖阈值”参数控制冰点，模拟冰河时代或全球变暖。
  - **自然边界：** 冰盖边缘具有噪声干扰，呈现有机形态而非完美的圆圈。
  - **优先级处理：** 冰盖具有最高优先级，覆盖并移除下层的生物群落。

### 2.4. 交互式控制
- **图形化控制面板 (Leva)：** 悬浮面板允许用户实时修改生成参数，无需刷新页面。
- **3D 导航：** 用户可以使用鼠标旋转、缩放和平移星球（OrbitControls）。

## 3. 技术架构

### 3.1. 技术栈
- **前端框架：** React (TypeScript)。
- **构建工具：** Vite。
- **3D 引擎：** Three.js (@react-three/fiber)。
- **辅助库：** @react-three/drei (用于 Gizmo 和轨道控制)。
- **UI 组件库：** Leva (用于参数调试)。

### 3.2. 渲染管线
- **几何体：** 高分辨率二十面体球 (Icosahedron)。
- **着色器：** 自定义 GLSL 顶点着色器 (Vertex Shader) 和片元着色器 (Fragment Shader)。
  - **顶点着色器：** 根据海拔噪声位移网格顶点。
  - **片元着色器：** 根据计算的海拔、湿度和温度值计算每个像素的最终颜色。